<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IELTS Writing Practice</title>
  <style>
    :root{
      --bg: #0f172a;          /* slate-900 */
      --panel: #111827;       /* gray-900 */
      --panel-2: #0b1222;     /* deep */
      --text: #e5e7eb;        /* gray-200 */
      --muted: #9ca3af;       /* gray-400 */
      --accent: #7c3aed;      /* violet-600 */
      --accent-2:#22d3ee;     /* cyan-400 */
      --ok: #10b981;          /* emerald-500 */
      --warn:#f59e0b;         /* amber-500 */
      --err: #ef4444;         /* red-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    html, body {height: 100%;}
    body{
      margin:0; background: radial-gradient(1200px 800px at 10% -10%, #1f2937 0%, transparent 60%),
                                 radial-gradient(900px 700px at 110% 10%, #111827 0%, transparent 50%),
                                 var(--bg);
      color:var(--text); font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }
    .app{max-width: 1400px; margin: 28px auto; padding: 0 16px;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    header.hero{ display:flex; gap:16px; align-items:center; justify-content:space-between; padding:10px 17px; background: linear-gradient(180deg, rgba(124,58,237,.18), rgba(124,58,237,.05)); border-bottom:1px solid rgba(255,255,255,.08);}
    .brand{ display:flex; align-items:center; gap:12px;}
    .logo{ width:38px; height:38px; border-radius:12px; background: conic-gradient(from 220deg, var(--accent), var(--accent-2)); filter: drop-shadow(0 6px 24px rgba(124,58,237,.35));}
    .title{ font-size: clamp(18px, 2.6vw, 24px); font-weight: 700; letter-spacing:.2px;}

    .toolbar{ display:flex; gap:10px; align-items:center; }
    .toolbar > * { white-space: nowrap; }

    .badge{ font-size: 12px; padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.08); color:var(--text); border:1px solid rgba(255,255,255,.12);}

    .grid{ display:grid; grid-template-columns: 1fr; gap:10px; padding:15px;}

    .row{ display:flex; gap:16px; flex-wrap:wrap; align-items:center; justify-content:space-between; }

    .counter-timer{ position: relative; display:flex; justify-content:space-between; padding:12px 14px; border-radius:12px; background: rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);}

    .left, .right{ display:flex; align-items:center; gap:10px; }

    .stat{ display:flex; flex-direction:column; gap:2px; }
    .stat label{ font-size:12px; color:var(--muted); }
    .stat .value{ font-size:18px; font-weight:700; letter-spacing:.3px; }

    .progress{
      appearance:none; width: 200px; height: 10px; border-radius:999px; background: rgba(255,255,255,.08); overflow:hidden; border:1px solid rgba(255,255,255,.08);
    }
    .progress::-webkit-progress-bar{ background: transparent; }
    .progress::-webkit-progress-value{ background: linear-gradient(90deg, var(--accent), var(--accent-2)); border-radius:999px; }
    .progress::-moz-progress-bar{ background: linear-gradient(90deg, var(--accent), var(--accent-2)); border-radius:999px; }

    .controls{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    button, select, input[type="number"]{
      background: rgba(255,255,255,.06); color:var(--text); border:1px solid rgba(255,255,255,.14);
      padding:10px 12px; border-radius:12px; font-weight:600; letter-spacing:.2px; cursor:pointer;
    }
    button:hover{ border-color: rgba(255,255,255,.28); }
    button.primary{ background: linear-gradient(180deg, rgba(124,58,237,.9), rgba(124,58,237,.7)); border: none; }
    button.ghost{ background: transparent; border:1px solid rgba(255,255,255,.16); }
    button:disabled{ opacity:.5; cursor:not-allowed; }
    select, input[type="number"]{ cursor: pointer; }
    input[type="number"]{ width: 96px; }

    .field{ display:flex; flex-direction:column; gap:8px; }
    .field label{ font-weight:600; color:var(--muted); }
    textarea{
      width: 100%; min-height: 110px; resize: vertical; border-radius:14px; padding:14px 16px; background: rgba(6, 11, 22, .55);
      border:1px solid rgba(255,255,255,.08); color:var(--text); font: 16px/1.6 ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      outline: none; box-shadow: inset 0 0 0 2px transparent; transition: box-shadow .2s ease, border-color .2s ease;
    }
    textarea:focus{ border-color: rgba(124,58,237,.65); box-shadow: inset 0 0 0 2px rgba(124,58,237,.35); }

    /* Specific styles for Question and Answer fields */
    #question {
      height: calc(1.1em * 3); /* roughly 3 lines */
      min-height: auto;
      width: 1325px;
    }
    #answer {
      width: 1325px;
      height: 550px;
    }

    .hint{ font-size:12px; color:var(--muted); }
    .pill{ font-size: 10px; padding:5px 8px; border-radius:999px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); }

    .footer{ display:flex; gap:10px; align-items:center; justify-content:space-between; padding: 0 4px; color:var(--muted); }

    .warning{ color: var(--warn); font-weight:700; }
    .ok{ color: var(--ok); font-weight:700; }

    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    @media (max-width: 720px){
      .counter-timer{ flex-direction: column; gap: 12px; align-items: stretch; }
      .progress{ width: 100%; }
      .controls{ width: 100%; justify-content: space-between; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <header class="hero" role="banner">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <div class="title">IELTS Writing Practice</div>
            <div class="hint">Write the question, then compose your answer. The word counter updates in real time. Timer in the top-right.</div>
          </div>
        </div>
        <div class="toolbar">
          <span class="badge">Auto‑save: On</span>
            <button id="exportBtn" class="ghost">Export Report</button>
        </div>
      </header>

      <div class="grid">
        <!-- Question field -->
        <div class="field">
            <div class="header">
                <label for="question">Question / Prompt</label> 
                <span class="pill" id="lastSavedQ"> </span> 
            </div>
          <textarea id="question" placeholder="e.g., Some people believe that unpaid community service should be a compulsory part of high school programmes (for example working for a charity, improving the neighbourhood or teaching sports to younger children). To what extent do you agree or disagree?" spellcheck="true"></textarea>
        </div>

        <!-- Top bar: word counter (left) and timer (right) -->
        <section class="counter-timer" aria-label="Status bar">
          <div class="left">
            <div class="stat">
              <label>Words</label>
              <div class="value" id="wordCount">0</div>
            </div>
            <progress id="wordProgress" class="progress" max="250" value="0" aria-label="Word goal progress"></progress>
            <span id="wordGoalLabel" class="pill">Goal: 250</span>
          </div>
          <div class="right">
            <div class="stat" style="min-width:92px; text-align:right;">
              <label>Timer</label>
              <div class="value" id="timerDisplay" aria-live="polite">40:00</div>
            </div>
            <div class="controls">
              <button id="startPauseBtn" class="primary">Start</button>
              <button id="resetBtn" class="ghost">Reset</button>
              <select id="taskSelect" title="Task preset">
                <option value="task2" selected>Task 2 (40m / 250w)</option>
                <option value="task1">Task 1 (20m / 150w)</option>
                <option value="custom">Custom…</option>
              </select>
              <input id="customMinutes" type="number" min="1" step="1" value="40" title="Custom minutes" aria-label="Custom minutes" style="display:none;" />
              <input id="customGoal" type="number" min="1" step="1" value="250" title="Custom word goal" aria-label="Custom word goal" style="display:none;" />
            </div>
          </div>
        </section>

        <!-- Answer field -->
        <div class="field">
            <div class="footer">
                <label for="answer">Your Answer</label>
                <span class="pill" id="lastSavedA"></span>
                <span id="wordAdvice" class="hint">Minimum 250 words recommended for Task 2.</span>
            </div>
          <textarea id="answer" placeholder="Start writing your response here…" spellcheck="true"></textarea>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Utilities =====
    const $ = (id) => document.getElementById(id);
    const pad = (n) => (n < 10 ? '0' + n : '' + n);

    // Accurate-ish word counting for IELTS (hyphenated & apostrophes treated as one word)
    function countWords(text){
      if(!text) return 0;
      // Normalize dashes to apostrophe-like and collapse whitespace
      const normalized = text
        .replace(/[—–]/g, '-')
        .replace(/[ˆ\u200B\u200C\u200D]/g,'')
        .trim();
      // Match sequences of letters (including accented) that may include internal hyphens/apostrophes
      const matches = normalized.match(/[A-Za-zÀ-ÖØ-öø-ÿ]+(?:['’-][A-Za-zÀ-ÖØ-öø-ÿ]+)*/g);
      return matches ? matches.length : 0;
    }

    // ===== Elements =====
    const wordCountEl = $('wordCount');
    const wordProgress = $('wordProgress');
    const wordGoalLabel = $('wordGoalLabel');
    const wordAdvice = $('wordAdvice');

    const timerDisplay = $('timerDisplay');
    const startPauseBtn = $('startPauseBtn');
    const resetBtn = $('resetBtn');
    const taskSelect = $('taskSelect');
    const customMinutes = $('customMinutes');
    const customGoal = $('customGoal');

    const question = $('question');
    const answer = $('answer');
    const lastSavedQ = $('lastSavedQ');
    const lastSavedA = $('lastSavedA');

    // ===== State =====
    let totalSeconds = 40 * 60;  // default Task 2
    let remaining = totalSeconds;
    let ticking = false;
    let timerId = null;
    let wordGoal = 250;

    // ===== Timer =====
    function renderTimer(){
      const m = Math.floor(remaining / 60);
      const s = remaining % 60;
      timerDisplay.textContent = `${pad(m)}:${pad(s)}`;
    }

    function startTimer(){
      if(ticking) return;
      ticking = true;
      startPauseBtn.textContent = 'Pause';
      timerId = setInterval(() => {
        if(remaining > 0){
          remaining--;
          renderTimer();
        } else {
          clearInterval(timerId); timerId = null; ticking = false;
          startPauseBtn.textContent = 'Start';
          // simple buzz
          try { new AudioContext().resume(); } catch(e){}
          if('vibrate' in navigator){ navigator.vibrate([200,100,200]); }
          timerDisplay.classList.add('warning');
        }
      }, 1000);
    }

    function pauseTimer(){
      ticking = false; startPauseBtn.textContent = 'Start';
      if(timerId) { clearInterval(timerId); timerId = null; }
    }

    function resetTimer(){
      pauseTimer(); remaining = totalSeconds; renderTimer(); timerDisplay.classList.remove('warning');
    }

    startPauseBtn.addEventListener('click', () => ticking ? pauseTimer() : startTimer());
    resetBtn.addEventListener('click', resetTimer);

    // ===== Presets (Task 1 / Task 2 / Custom) =====
    function applyPreset(preset){
      if(preset === 'task1'){
        totalSeconds = 20 * 60; wordGoal = 150;
        customMinutes.style.display = 'none'; customGoal.style.display = 'none';
      } else if(preset === 'task2'){
        totalSeconds = 40 * 60; wordGoal = 250;
        customMinutes.style.display = 'none'; customGoal.style.display = 'none';
      } else {
        customMinutes.style.display = 'inline-block';
        customGoal.style.display = 'inline-block';
        totalSeconds = Math.max(1, parseInt(customMinutes.value || '40', 10)) * 60;
        wordGoal = Math.max(1, parseInt(customGoal.value || '250', 10));
      }
      wordProgress.max = wordGoal;
      wordGoalLabel.textContent = `Goal: ${wordGoal}`;
      wordAdvice.textContent = `Minimum ${wordGoal} words recommended for ${preset === 'task1' ? 'Task 1' : (preset === 'task2' ? 'Task 2' : 'Custom')}.`;
      remaining = totalSeconds; renderTimer(); timerDisplay.classList.remove('warning');
      updateWordCount();
      saveMeta();
    }

    taskSelect.addEventListener('change', () => applyPreset(taskSelect.value));
    customMinutes.addEventListener('change', () => applyPreset('custom'));
    customGoal.addEventListener('change', () => applyPreset('custom'));

    // ===== Word Counter =====
    function updateWordCount(){
      const words = countWords(answer.value);
      wordCountEl.textContent = words;
      wordProgress.value = Math.min(words, wordGoal);

      if(words >= wordGoal){
        wordCountEl.classList.add('ok');
        wordCountEl.classList.remove('warning');
      } else {
        wordCountEl.classList.remove('ok');
        wordCountEl.classList.add('warning');
      }
    }

    answer.addEventListener('input', () => { updateWordCount(); autoSave('answer', answer.value, lastSavedA); });

    // ===== Auto‑save (localStorage) =====
    const KEY = 'ielts_write_practice_v1';
    function saveMeta(){
      const preset = taskSelect.value;
      const meta = { preset, customMinutes: customMinutes.value, customGoal: customGoal.value };
      const snapshot = JSON.parse(localStorage.getItem(KEY) || '{}');
      snapshot.meta = meta;
      localStorage.setItem(KEY, JSON.stringify(snapshot));
    }
    function autoSave(field, value, badgeEl){
      const snapshot = JSON.parse(localStorage.getItem(KEY) || '{}');
      snapshot[field] = value;
      snapshot.timestamp = Date.now();
      localStorage.setItem(KEY, JSON.stringify(snapshot));
      if(badgeEl){ badgeEl.textContent = 'Saved ' + new Date(snapshot.timestamp).toLocaleTimeString(); }
    }
    function restore(){
      try{
        const data = JSON.parse(localStorage.getItem(KEY) || '{}');
        if(data.question){ question.value = data.question; lastSavedQ.textContent = 'Saved ' + new Date(data.timestamp).toLocaleTimeString(); }
        if(data.answer){ answer.value = data.answer; lastSavedA.textContent = 'Saved ' + new Date(data.timestamp).toLocaleTimeString(); }
        if(data.meta){
          taskSelect.value = data.meta.preset || 'task2';
          if(data.meta.customMinutes) customMinutes.value = data.meta.customMinutes;
          if(data.meta.customGoal) customGoal.value = data.meta.customGoal;
        }
      }catch(e){ /* ignore */ }
      applyPreset(taskSelect.value);
      updateWordCount();
    }


    function exportReport() {
    const q = question.value.trim();
    const a = answer.value.trim();
    const words = countWords(a);
    const time = new Date().toLocaleString();

    const content = 
    `IELTS Writing Practice Report
    ==============================
    Saved: ${time}

    Question:
    ${q || "(no question entered)"}

    Answer:
    ${a || "(no answer entered)"}

    Word count: ${words}
    Goal: ${wordGoal}
    `;

    const blob = new Blob([content], {type: "text/plain"});
    const url = URL.createObjectURL(blob);

    const link = document.createElement("a");
    link.href = url;
    link.download = "IELTS_Writing_Report.txt";
    link.click();

    URL.revokeObjectURL(url);
    }

    $('exportBtn').addEventListener('click', exportReport);


    question.addEventListener('input', () => autoSave('question', question.value, lastSavedQ));

    // ===== Init =====
    restore();

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){
        e.preventDefault();
        autoSave('question', question.value, lastSavedQ);
        autoSave('answer', answer.value, lastSavedA);
      }
      if(e.code === 'Space' && (e.ctrlKey || e.metaKey)){
        e.preventDefault();
        ticking ? pauseTimer() : startTimer();
      }
      if(e.key.toLowerCase() === 'r' && (e.ctrlKey || e.metaKey)){
        e.preventDefault();
        resetTimer();
      }
    });
  </script>
</body>
</html>
